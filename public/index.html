<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>Minecraft Shader Pack Progress Report</title>
	<style>
		body {
			font-family: Arial, sans-serif;
			padding: 20px;
			background-color: #f5f5f5;
		}
		h1 {
			font-size: 48px;
			margin-bottom: 20px;
			text-align: center;
		}
		h2 {
			font-size: 36px;
			margin-bottom: 10px;
			color: #1E90FF;
		}
        h3 {
            font-size: 24px;
            margin-bottom: 10px;
            
        }
        figure {
            font-size: 14px;
            text-align: center;
        }
        video {
            font-size: 14px;
            text-align: center;
        }
		p {
			font-size: 18px;
			margin-bottom: 20px;
			line-height: 1.5;
		}
		img {
			max-width: 100%;
			margin-bottom: 20px;
			border-radius: 10px;
			box-shadow: 2px 2px 8px rgba(0,0,0,0.2);
		}
		.container {
			max-width: 800px;
			margin: 0 auto;
		}
		.section {
			margin-bottom: 60px;
		}
		.byline {
			font-size: 16px;
			font-style: italic;
			color: #666;
			text-align: center;
		}
		.subtitle {
			font-size: 14px;
			color: #666;
			text-align: center;
			margin-top: 10px;
		}
	</style>
</head>
<body>
	<div class="container">
		<h1>Making Minecraft Look Good</h1>

		<div class="byline">By Shahar Sandhaus, Duan Lyu, Ziqi Shi, Vincent Lee</div>
		<p class="subtitle">View this report online: <a href="https://cs184.milestone.sandhaus.dev">https://cs184.milestone.sandhaus.dev</a></p>

		<div class="section">
			<h2>Cell Shader Implementation</h2>
			<p>The first thing we chose to implement for this project was a simple cell shader. Cell shading is a post processing technique where the pixel colors are divided into discrete ranges, which are then rendered as a flat brightness. This technique is employed by games like <em>Borderlands</em> and  <em>The Legend of Zelda: The Wind Waker</em> to create stylized worlds with a slightly "comic-like" look. Unlike those games, cell shading in Minecraft looks quite bad. However, it's very easy to implement, and therefore we decided to start with it. </p>
			<p>After following a few tutorials on the basics of shading in Minecraft, we found that we could achive our goal of implementing a cell shader by modifying the fragment shader for the "final" rendering pass, which is an internal rendering pass where final post processing effects can be applied to the framebuffer. Here is what that cell shader looks like in game:</p>
			<figure>
				<img src="cell.png" alt="Minecraft world with cell shader applied">
				<figcaption>Minecraft world with cell shader applied</figcaption>
			</figure>
			<p>Since cell shader isn't necessarily the best visual effects from a normal gameplay point of view, we also added the options to turn cell shading on and off within our shader. </p>
			<figure>
				<img src="cellsetting.png" alt="Option for turning cell shader on and off">
				<figcaption>Option for turning cell shader on and off</figcaption>
			</figure>
		</div>

		<div class="section">
			<h2>Wind Effect Implementation</h2>
			<p>After the sucess of our cell shader, we decided to move onto a shader that adds a "wind-like" effect to the leaves of trees. The wind effect is a common feature in many Minecraft shader packs and adds a sense of dynamism to the game. We figured such an effect could be easily created by editing the vertex shader of the leaf blocks to add a time-dependant offset to the position, which would give the illusion of leaves being blown by the wind. After a bit of tweaking, we where able to get a pretty decent looking implementation:</p>
			<figure>
			<video width="640" height="360" controls autoplay loop>
				<source src="leaves.mp4" alt="Minecraft world with crude wind effect applied">
			</video>
			<figcaption>Wind effect in game</figcaption>
		</figure>
		</div>

		<div class="section">
			<h2>Advanced Lighting System</h2>
			<p>Now that we implemented some simple effects, it was time for the big boy: <strong><em>lighting</em></strong>. Minecraft's default lighting looks pretty boring, and there is a lot of room for improvement... so we went to work.</p>
			<h3>Light from the sun</h3>
			<p>The first thing we tried adding to sprice up the lighting was basic "diffuse lighting" that shaded the side of blocks depending on the angle they make with the sun. This was basically a super simple directional diffuse lighting implementation, which frankly didn't look very good. But it was a good start:</p>
			<figure>
				<img src="BasicSun.png" alt="Minecraft world with basic sun lighting applied">
				<figcaption>Minecraft world with basic sun lighting applied</figcaption>
			</figure>

			<h3>Light Map and Shadow Map Integration</h3>
			<p>The basic solar lighting left a lot to be desired. First and foremost, since we implemented the diffuse lighting in the final pass of the OptiFine workflow, the render is applied to the full screen without consideration of the rendered object. This results in the sky being rendered wrong, specifically the sky becomes darker when the camera turns towards the sun, where the aforementioned brightness dot product value goes to 0. In addition, since blocks' brightness values were completely determined by the position of the sun, they appear darker even when illuminated by a light source block like torch or glowstone. Lastly, since there were no consideration of blocks blocking the sun, surfaces facing the sun are bright even when sunlight cannot hit them.</p>
			<figure>
				<video width="640" height="360" controls loop>
					<source src="sky.mp4" alt="Lighting change as camera turn towards the sun">
				</video>
				<figcaption>Lighting change as camera turn towards the sun</figcaption>
			</figure>

			<figure>
				<img src="FailIllum.png" alt="Light sources fail to illuminate surfaces facing away from the sun">
				<figcaption>Light sources(Glowstone) fail to illuminate surfaces facing away from the sun</figcaption>
			</figure>
			<figure>
				<img src="Night.png" alt="Abnormally bright surfaces at night">
				<figcaption>Abnormally bright surfaces at night</figcaption>
			</figure>
			<p>To resolve these problems, we made use of 2 other maps in the OptiFine workflow, lightmap and shadow map. First, we resolved the illumination problem The lightmap stores two values, light intensity from the sky, and light intensity from nearby lightsources. By combining these values with the diffuse lighting intensity from the previous part, we can render the illumination effects from light sources other than the sun. </p>
			<figure>
				<img src="Illum.png" alt="Blocks illuminated by lightsources other than the sun">
				<figcaption>Blocks illuminated by lightsources other than the sun</figcaption>
			</figure>
			<p>In this step, we also added a few options to change the rgb colors of the lightsources. Other shader packs often use a light temperature setting to allow users to tweak this, but we thought it's more fun to allow green and blue lighting.</p>
			<figure>
				<img src="IllumSettings.png" alt="Options for changing various lighting values">
				<figcaption>Options for changing various lighting values</figcaption>
			</figure>
			<p>Then, we used the shadow map to fix the sun lighting. The shadow map simply stores a depth value between 1.0f and 0.0f that shows how far away a block is from the sun, while a sky pixel always has a distance of 1.0f and a blocked pixel always has a value of 0.0f. By multiplying this value with the sun brightness value, we can fix the sun lighting rendering and see more realistic shadows.</p>
			<figure>
				<img src="ShadowMapInitial.png" alt="Minecraft world after integrating sun lighting depths.">
				<figcaption>Minecraft world after integrating sun lighting depths.</figcaption>
			</figure>

			<h3>Shadow map Distortion</h3>
			<p>Obviously, A simple shadow map results in a blobby and low-resolution shadow. To address this issue, we implemented a shadow map distortion algorithm that allows us to store more detailed shadows closer to the avatar(camera) and less detailed shadows further away, allowing more detailed shadows in closer positions while keeping reasonable use of computational resources. After this, our shadows are no longer blobby and can better represent the real world lighting. Furthermore, we also put a cap on the color value of pixels internally to fix some dynamic range issues. The final result looks like this:</p>
			<figure>
				<img src="FinalDiffuse.png" alt="Shadows with shadow map distortion.">
				<figcaption>Shadows with shadow map distortion.</figcaption>
			</figure>
		</div>

		<p>Overall, we am happy with the progress we have made on our custom shader pack. we look forward to continuing to refine and improve upon these effects. In the last week, we are looking forward to explore more in realistic water shading in addition to polishing our completed diffuse lighting shader.</p>
	</div>
</body>

</html>